<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>reslr: advanced • reslr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="reslr: advanced">
<meta property="og:description" content="reslr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">reslr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/reslr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/advanced_reslr.html">reslr: advanced</a>
    </li>
    <li>
      <a href="../articles/quick_start.html">reslr: quick start guide</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>reslr: advanced</h1>
                        <h4 data-toc-skip class="author">Maeve Upton,
Andrew Parnell and Niamh Cahill</h4>
            
            <h4 data-toc-skip class="date">2023-05-24</h4>
      
      
      <div class="hidden name"><code>advanced_reslr.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this document we present a range of advanced options that are
available in the reslr package. To examine the all other options in the
<code>reslr</code> package, see the main vignette.</p>
<p>If you have created other examples demonstrating <code>reslr</code>
capabilities yourself, please <a href="https://github.com/maeveupton/reslr/issues" class="external-link">contact me</a> so I
can include them here for other people to see.</p>
<p>Installing <code>reslr</code> and loading it with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#install.packages("reslr")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"maeveupton/reslr"</span>,force <span class="op">=</span> <span class="cn">TRUE</span>,INSTALL_opts <span class="op">=</span> <span class="st">'--no-lock'</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">reslr</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="errors-in-variables-integrated-gaussian-process-with-detrended-data">Errors in Variables Integrated Gaussian Process with detrended
data<a class="anchor" aria-label="anchor" href="#errors-in-variables-integrated-gaussian-process-with-detrended-data"></a>
</h2>
<p>The EIV Integrated Gaussian Process model provides the underlying
rate of the process directly from the model. If the user requires a
model applied to data that has been de-trended this is available in our
package for a single site using the
<code>model_type = "eiv_igp_t"</code>. The data is de-trended using the
linear rate which can be provided by the user within the input dataframe
along with the uncertainty associated with the rate. Or the linear rate
is calculated within the package using the data and this rate is used to
de-trend the data. In addition, the user will need to provide the
estimated year of core collection.</p>
<p>This technique focuses on 1 site and we do not recommended for
multiple proxy sites together. Tide gauge data can be included, however,
the user must investigate which tide gauge is suitable and the tide
gauge data will use the same linear_rate as the proxy records. As an
example, we will filter the example dataset <code>NAACproxydata</code>
to select one site to demonstrate the process:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For 1 site</span></span>
<span><span class="va">CedarIslandNC</span> <span class="op">&lt;-</span> <span class="fu">reslr</span><span class="fu">::</span><span class="va"><a href="../reference/NAACproxydata.html">NAACproxydata</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Site</span> <span class="op">==</span> <span class="st">"Cedar Island"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Step 1:</strong> Load in the data using the
<code>reslr_load</code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CedarIslandNC_input_detrend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reslr_load.html">reslr_load</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">CedarIslandNC</span>,</span>
<span>  include_tide_gauge <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  include_linear_rate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  TG_minimum_dist_proxy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  list_preferred_TGs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  all_TG_1deg <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  prediction_grid_res <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  sediment_average_TG <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  detrend_data <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  core_col_year <span class="op">=</span> <span class="fl">2010</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For this case, we update the setting <code>detrend_data = TRUE</code>
and we provide the <code>core_col_year = 2010</code> corresponding to
the year of the core collection. The linear_rate is required and is
included by setting <code>include_linear_rate = TRUE</code>.</p>
<p>The output of this function is a list of two dataframes called
<code>data</code> and <code>data_grid</code>. - The <code>data</code>
dataframe is the inputted data with additional columns for the
data_type_id which will contain “ProxyRecord”. It can be accessed
by:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">CedarIslandNC_input_detrend</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<ul>
<li>The <code>data_grid</code> is a dataframe that is evenly spaced in
time based on the <code>prediction_grid_res</code> value chosen by the
user and is used to create the plots and is accessed by</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_grid</span> <span class="op">&lt;-</span> <span class="va">CedarIslandNC_input_detrend</span><span class="op">$</span><span class="va">data_grid</span></span></code></pre></div>
<p><strong>Step 1a:</strong> A brief insight into the outputs of the
<code>reslr_input</code> function can be obtained using:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">CedarIslandNC_input_detrend</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## This is a valid reslr input object with 104 observations and  1 site(s).</span></span>
<span><span class="co">## There are  1  proxy site(s) and  0  tide gauge site(s).</span></span>
<span><span class="co">## The age units are; Common Era. </span></span>
<span><span class="co">## Decadally averaged tide gauge data was not included. It is recommended for the ni_gam_decomp model </span></span>
<span><span class="co">## The linear_rate and linear_rate_err has been included. </span></span>
<span><span class="co">## Data has been detrended.</span></span></code></pre>
<p><strong>Step 2:</strong> Plotting the data the raw data with:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">CedarIslandNC_input_detrend</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Plot of the raw detrended data"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Year (CE)"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Sea Level (m)"</span>,</span>
<span>  plot_proxy_records <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_tide_gauges <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_reslr_files/figure-html/plotigpdata-1.png" width="672" style="display: block; margin: auto;">
This will produce a plot of Age on the x-axis and Sea Level on the
y-axis in meters. Grey boxes represent the uncertainty associated with
the vertical and horizontal uncertainty. The black data points are the
midpoints of these uncertainty boxes. The extra arguments can be used
which allows the user to updated the titles and axis labels. The caption
<code>plot_caption</code>, included by default, provides the number of
proxy sites and tide gauge sites that will be used in the model and can
be removed if required <code>plot_caption = FALSE</code>. In addition,
the user can select to plot the additional tide gauge data,
<code>plot_tide_gauge = TRUE</code>.</p>
<p><strong>Step 3:</strong> To run the eiv_igp_t model the following
function should be used:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_eiv_igp_t_detrend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reslr_mcmc.html">reslr_mcmc</a></span><span class="op">(</span></span>
<span>  input_data <span class="op">=</span> <span class="va">CedarIslandNC_input_detrend</span>,</span>
<span>  model_type <span class="op">=</span> <span class="st">"eiv_igp_t"</span>,</span>
<span>  CI <span class="op">=</span> <span class="fl">0.95</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This command takes the input data and the user specifies the
statistical model, i.e. an integrated Gaussian process using the EIV
uncertainty method (“eiv_slr_t”). It tells <code>reslr</code> to store
the output of the model run in an object called
<code>res_eiv_igp_t</code>. The <code>CI</code> setting allows the user
to set the credible intervals, the current default is
<code>CI = 0.95</code>.</p>
<p><strong>Step 3a:</strong> A brief insight into the outputs of the
<code>reslr_output</code> function can be obtained using:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res_eiv_igp_t_detrend</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## This is a valid reslr output object with 104 observations and  1 site(s).</span></span>
<span><span class="co">## There are  1  proxy site(s) and  0  tide gauge site(s).</span></span>
<span><span class="co">## The age units are; Common Era. </span></span>
<span><span class="co">## Model has used detrended data.</span></span>
<span><span class="co">## The model used was the Errors-in-Variables Integrated Gaussian Process model in time for detrended data.</span></span>
<span><span class="co">## The input data has been run via reslr_mcmc and has produced 3000 iterations over 3 MCMC chains.</span></span></code></pre>
<p><strong>Step 4:</strong> The convergence of the algorithm is examined
and he parameter estimates from the model can be investigated using the
following:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res_eiv_igp_t_detrend</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## No convergence issues detected.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">##   variable    mean      sd     mad       q5    q95  rhat</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;num&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;num&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;num&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;num&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;num&gt;</span> <span style="color: #949494; font-style: italic;">&lt;num&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> nu       0.795   0.367   0.287   0.384    1.52    1.00</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> rho      0.223   0.112   0.115   0.061<span style="text-decoration: underline;">7</span>   0.419   1.00</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> sigma_y  0.006<span style="text-decoration: underline;">36</span> 0.004<span style="text-decoration: underline;">79</span> 0.004<span style="text-decoration: underline;">58</span> 0.000<span style="text-decoration: underline;">496</span> 0.015<span style="text-decoration: underline;">9</span>  1.00</span></span></code></pre>
<p>If the model run has the package will print: “No convergence issues
detected”. If the package prints: “Convergence issues detected, a longer
run is necessary”. The user is required to update the
<code>reslr_mcmc</code> function with additional iterations in the
following manner:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_eiv_igp_t_detrend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reslr_mcmc.html">reslr_mcmc</a></span><span class="op">(</span></span>
<span>  input_data <span class="op">=</span> <span class="va">CedarIslandNC_input_detrend</span>,</span>
<span>  model_type <span class="op">=</span> <span class="st">"eiv_igp_t"</span>,</span>
<span>  <span class="co"># Update these values</span></span>
<span>  n_iterations <span class="op">=</span> <span class="fl">6000</span>, <span class="co"># Number of iterations</span></span>
<span>  n_burnin <span class="op">=</span> <span class="fl">1000</span>, <span class="co"># Number of iterations to discard at the beginning</span></span>
<span>  n_thin <span class="op">=</span> <span class="fl">4</span>, <span class="co"># Reduces number of output samples to save memory and computation time</span></span>
<span>  n_chains <span class="op">=</span> <span class="fl">3</span> <span class="co"># Number of Markov chains</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For the parameter estimates, the length scale parameter, “rho” is the
correlation parameter and “nu” is the standard deviation of the rate
process. “sigma_y” is the variation of the model.</p>
<p><strong>Step 5:</strong> The results from the EIV IGP model for the
de-trended data can be illustrated using:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_eiv_igp_t_detrend</span>,</span>
<span>  plot_type <span class="op">=</span> <span class="st">"model_fit_plot"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Year (CE)"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Sea Level (m)"</span>,</span>
<span>  plot_proxy_records <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_tide_gauges <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_reslr_files/figure-html/plotigpres-1.png" width="672" style="display: block; margin: auto;">
The output of this function is a graph of the input data, i.e. Age and
SL and associated uncertainty boxes, and the model fit with 95 %
credible interval. The caption provides the model type used and number
of proxy sites and tide gauge sites used and can be removed if necessary
with <code>plot_caption = FALSE</code>. In order to view the rate of
change plot, the following setting should be used:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_eiv_igp_t_detrend</span>,</span>
<span>  plot_type <span class="op">=</span> <span class="st">"rate_plot"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Year (CE)"</span>,</span>
<span>  y_rate_lab <span class="op">=</span> <span class="st">"Rate of Change (mm per year)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_reslr_files/figure-html/plotigpresrate-1.png" width="672" style="display: block; margin: auto;">
This prints the plot of the rate of change with 95 % credible intervals.
The caption provides the model type, the number of proxy sites and tide
gauge sites that were used.</p>
<p>To examine the data creating these plots the user types the
following:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_dataframes</span> <span class="op">&lt;-</span> <span class="va">res_eiv_igp_t_detrend</span><span class="op">$</span><span class="va">output_dataframes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">output_dataframes</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 14</span></span></span>
<span><span class="co">##   Longitude Latitude SiteName     linear_rate linear_rate_err data_type_id   Age</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     -<span style="color: #BB0000;">76.4</span>     35.0 <span style="color: #949494;">"</span>Cedar Isla…       0.741         0.009<span style="text-decoration: underline;">71</span> ProxyRecord  -<span style="color: #BB0000;">865.</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     -<span style="color: #BB0000;">76.4</span>     35.0 <span style="color: #949494;">"</span>Cedar Isla…       0.741         0.009<span style="text-decoration: underline;">71</span> ProxyRecord  -<span style="color: #BB0000;">750</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     -<span style="color: #BB0000;">76.4</span>     35.0 <span style="color: #949494;">"</span>Cedar Isla…       0.741         0.009<span style="text-decoration: underline;">71</span> ProxyRecord  -<span style="color: #BB0000;">700</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     -<span style="color: #BB0000;">76.4</span>     35.0 <span style="color: #949494;">"</span>Cedar Isla…       0.741         0.009<span style="text-decoration: underline;">71</span> ProxyRecord  -<span style="color: #BB0000;">650</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>     -<span style="color: #BB0000;">76.4</span>     35.0 <span style="color: #949494;">"</span>Cedar Isla…       0.741         0.009<span style="text-decoration: underline;">71</span> ProxyRecord  -<span style="color: #BB0000;">600</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>     -<span style="color: #BB0000;">76.4</span>     35.0 <span style="color: #949494;">"</span>Cedar Isla…       0.741         0.009<span style="text-decoration: underline;">71</span> ProxyRecord  -<span style="color: #BB0000;">550</span> </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 7 more variables: pred &lt;dbl&gt;, upr &lt;dbl&gt;, lwr &lt;dbl&gt;, rate_pred &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   rate_upr &lt;dbl&gt;, rate_lwr &lt;dbl&gt;, CI &lt;chr&gt;</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="using-a-different-input-age-unit">Using a different input age unit<a class="anchor" aria-label="anchor" href="#using-a-different-input-age-unit"></a>
</h2>
<p>The default input age for the reslr package is in units of years in
the Common Era. The user can select to input the age value in Before
Present by updating the <code>input_age_type = "BP"</code>. Inside the
package, the Age is converted into CE in order to run the models. The
plots are then altered to account for the input age in BP and the axis
is be reversed. Here is an example of how this is done using the same
example site as the previous case but using a Noisy Input spline in time
instead.</p>
<p>As an example, we will filter the example dataset
<code>NAACproxydata</code> to select one site to demonstrate the
process:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For 1 site</span></span>
<span><span class="va">CedarIslandNC</span> <span class="op">&lt;-</span> <span class="fu">reslr</span><span class="fu">::</span><span class="va"><a href="../reference/NAACproxydata.html">NAACproxydata</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Site</span> <span class="op">==</span> <span class="st">"Cedar Island"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Step 1:</strong> Load in the data using the
<code>reslr_load</code> function:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CedarIslandNC_input_age_BP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reslr_load.html">reslr_load</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">CedarIslandNC</span>,</span>
<span>  include_tide_gauge <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  include_linear_rate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  TG_minimum_dist_proxy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  list_preferred_TGs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  all_TG_1deg <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  prediction_grid_res <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  sediment_average_TG <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  input_age_type <span class="op">=</span> <span class="st">"BP"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For this case, we update the setting
<code>input_age_type = "BP"</code>.</p>
<p>The output of this function is a list of two dataframes called
<code>data</code> and <code>data_grid</code>. - The <code>data</code>
dataframe is the inputted data with additional columns for the
data_type_id which will contain “ProxyRecord”. A column is included to
identify the <code>Age_type = "BP"</code> and an additional column is
included called <code>Age_BP</code> which contains the original input
Age in units Before Present. It can be accessed by:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">CedarIslandNC_input_age_BP</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<ul>
<li>The <code>data_grid</code> is a dataframe that is evenly spaced in
time based on the <code>prediction_grid_res</code> value chosen by the
user and is used to create the plots and is accessed by</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_grid</span> <span class="op">&lt;-</span> <span class="va">CedarIslandNC_input_age_BP</span><span class="op">$</span><span class="va">data_grid</span></span></code></pre></div>
<p><strong>Step 1a:</strong> A brief insight into the outputs of the
<code>reslr_input</code> function can be obtained using:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">CedarIslandNC_input_age_BP</span><span class="op">)</span></span></code></pre></div>
<p><strong>Step 2:</strong> Plotting the data the raw data with:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">CedarIslandNC_input_age_BP</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Plot of the raw data with input Age in Before Present"</span>,</span>
<span>  plot_proxy_records <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_tide_gauges <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This will produce a plot of Age in units of BP on the x-axis and RSL
on the y-axis in meters. Grey boxes represent the uncertainty associated
with the vertical and horizontal uncertainty. The black data points are
the midpoints of these uncertainty boxes. The extra arguments can be
used which allows the user to updated the titles and axis labels. The
caption <code>plot_caption</code>, included by default, provides the
number of proxy sites and tide gauge sites that will be used in the
model and can be removed if required <code>plot_caption = FALSE</code>.
In addition, the user can select to plot the additional tide gauge data,
<code>plot_tide_gauge = TRUE</code>.</p>
<p><strong>Step 3:</strong> To run the ni_sp_t model the following
function should be used:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_ni_sp_t_age_BP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reslr_mcmc.html">reslr_mcmc</a></span><span class="op">(</span></span>
<span>  input_data <span class="op">=</span> <span class="va">CedarIslandNC_input_age_BP</span>,</span>
<span>  model_type <span class="op">=</span> <span class="st">"ni_sp_t"</span>,</span>
<span>  CI <span class="op">=</span> <span class="fl">0.95</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This command takes the input data and the user specifies the
statistical model, i.e. an integrated Gaussian process using the EIV
uncertainty method (“eiv_slr_t”). It tells <code>reslr</code> to store
the output of the model run in an object called
<code>res_ni_sp_t_age_BP</code>. The <code>CI</code> setting allows the
user to set the credible intervals, the current default is
<code>CI = 0.95</code>.</p>
<p><strong>Step 3a:</strong> A brief insight into the outputs of the
<code>reslr_output</code> function can be obtained using:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res_ni_sp_t_age_BP</span><span class="op">)</span></span></code></pre></div>
<p><strong>Step 4:</strong> The convergence of the algorithm is examined
and he parameter estimates from the model can be investigated using the
following:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res_ni_sp_t_age_BP</span><span class="op">)</span></span></code></pre></div>
<p>If the model run has the package will print: “No convergence issues
detected”. If the package prints: “Convergence issues detected, a longer
run is necessary”. The user is required to update the
<code>reslr_mcmc</code> function with additional iterations.</p>
<p><strong>Step 5:</strong> The results from the EIV IGP model for the
de-trended data can be illustrated using:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_ni_sp_t_age_BP</span>,</span>
<span>  plot_type <span class="op">=</span> <span class="st">"model_fit_plot"</span>,</span>
<span>  plot_proxy_records <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_tide_gauges <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The output of this function is a graph of the input data, i.e. Age
and RSL and associated uncertainty boxes, and the model fit with 95 %
credible interval. The caption provides the model type used and number
of proxy sites and tide gauge sites used and can be removed if necessary
with <code>plot_caption = FALSE</code>. In order to view the rate of
change plot, the following setting should be used:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_ni_sp_t_age_BP</span>,</span>
<span>  plot_type <span class="op">=</span> <span class="st">"rate_plot"</span>,</span>
<span>  y_rate_lab <span class="op">=</span> <span class="st">"Rate of Change (mm per year)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This prints the plot of the rate of change with 95 % credible
intervals. The caption provides the model type, the number of proxy
sites and tide gauge sites that were used.</p>
<p>To examine the data creating these plots the user types the
following:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_dataframes</span> <span class="op">&lt;-</span> <span class="va">res_ni_sp_t_age_BP</span><span class="op">$</span><span class="va">output_dataframes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">output_dataframes</span><span class="op">)</span></span></code></pre></div>
<p>Note that if recreating these plots, the user is required to use the
<code>Age_BP</code> column along the x-axis as it provides the original
input age in units Before Present (BP) and the x-axis will need to be
reversed.</p>
</div>
<div class="section level2">
<h2 id="including-tide-gauge-data">Including Tide Gauge data<a class="anchor" aria-label="anchor" href="#including-tide-gauge-data"></a>
</h2>
<p>In this package, we have described three ways to select a tide gauge
and in the example we showed how to include the closest tide gauge to
the proxy site. Here we are demonstrating the other options available to
the user.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For 2 site</span></span>
<span><span class="va">multi_site</span> <span class="op">&lt;-</span> <span class="fu">reslr</span><span class="fu">::</span><span class="va"><a href="../reference/NAACproxydata.html">NAACproxydata</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Site</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cedar Island"</span>, <span class="st">"Nassau"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If the user has a list of chosen tide gauges from PSMSL website,
include them in a list in the <code>reslr_load</code> function as
demonstrated:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multi_site</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reslr_load.html">reslr_load</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">multi_site</span>,</span>
<span>  include_tide_gauge <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  include_linear_rate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  TG_minimum_dist_proxy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="co"># There is no limit to the number of tide gauges provided in the list</span></span>
<span>  list_preferred_TGs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"ARGENTIA"</span>, <span class="st">"MAYPORT"</span>,</span>
<span>    <span class="st">"JACKSONVILLE"</span>, <span class="st">"LAKE WORTH PIER"</span>,</span>
<span>    <span class="st">"MAYPORT (BAR PILOTS DOCK), FLORIDA"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  all_TG_1deg <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  prediction_grid_res <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  sediment_average_TG <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here is how to plot this example:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">multi_site</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Plot of the raw data"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Year (CE)"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Relative Sea Level (m)"</span>,</span>
<span>  plot_tide_gauges <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_proxy_records <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_caption <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>If the user requires all tide gauges within 1 degree of the proxy
site, which is the equivalent of 111kms, this can be done by updating
<code>all_TG_1deg=TRUE</code> in the following way:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multi_site</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reslr_load.html">reslr_load</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">multi_site</span>,</span>
<span>  include_tide_gauge <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  include_linear_rate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  TG_minimum_dist_proxy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  list_preferred_TGs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  all_TG_1deg <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  prediction_grid_res <span class="op">=</span> <span class="fl">50</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here is how to plot this example:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">multi_site</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Plot of the raw data"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Year (CE)"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Relative Sea Level (m)"</span>,</span>
<span>  plot_tide_gauges <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_proxy_records <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_caption <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plotting-techniques">Plotting techniques<a class="anchor" aria-label="anchor" href="#plotting-techniques"></a>
</h2>
<p>In the package, all plot labels for results, i.e. x and y labels and
titles, can be updated in the following manner:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example</span></span>
<span><span class="va">final_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>jags_output <span class="op">=</span> <span class="fu"><a href="../reference/reslr_mcmc.html">reslr_mcmc</a></span><span class="op">(</span><span class="va">CedarIslandNC</span>, model_type <span class="op">=</span> <span class="st">"ni_spline_t"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">final_plots</span><span class="op">$</span><span class="va">plot_result</span></span>
<span><span class="co"># Adding new title to the total model fit plot</span></span>
<span><span class="va">final_plots</span><span class="op">$</span><span class="va">plot_result</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"New Title Added as Example"</span><span class="op">)</span></span>
<span><span class="va">final_plots</span><span class="op">$</span><span class="va">plot_result</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"New x axis label Added as Example"</span><span class="op">)</span></span>
<span><span class="va">final_plots</span><span class="op">$</span><span class="va">plot_result</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"New y axis label Added as Example"</span><span class="op">)</span></span></code></pre></div>
<p>The user can access the dataframes creating these plots in order to
recreate the output plots in their own style. To access the data frame
used to create the raw plot use:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">CedarIslandNC_input_detrend</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<p>To access the dataframe creating the output model fit plot use:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">res_eiv_igp_t_detrend</span><span class="op">$</span><span class="va">output_dataframes</span></span></code></pre></div>
<p>This dataframes contains the model fit under the column
<code>pred</code> and the rate of change column is
<code>rate_pred</code>.</p>
<p>For the <code>ni_gam_decomp</code> model, there are a separate
dataframe for each component and the rate of change for each component
has a corresponding dataframe. This ensures the decomposition of the RSL
signal can be plotted with all four components together, using separate
colours to identify the different drivers of RSL change.</p>
</div>
<div class="section level2">
<h2 id="accessing-the-posterior-samples">Accessing the posterior samples<a class="anchor" aria-label="anchor" href="#accessing-the-posterior-samples"></a>
</h2>
<p>In the package the user has the ability access all the posterior
sample for each unknown parameter in the following way:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example</span></span>
<span><span class="va">CedarIslandNC_input</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reslr_load.html">reslr_load</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">CedarIslandNC</span><span class="op">)</span></span>
<span><span class="va">res_eiv_slr_t</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/reslr_mcmc.html">reslr_mcmc</a></span><span class="op">(</span><span class="va">CedarIslandNC_input</span>, </span>
<span>             model_type <span class="op">=</span> <span class="st">"eiv_slr_t"</span><span class="op">)</span></span>
<span><span class="co"># Accessing the slope of the EIV simple linear regression</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="va">res_eiv_slr_t</span><span class="op">$</span><span class="va">noisy_model_run_output</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">sims.list</span><span class="op">$</span><span class="va">beta</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Maeve Upton.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
